<div data-ng-controller="TipCtrl">
  <div class="row">
    <div class="col-md-12">
      <div class="pull-left">
        <a id="link-tiplist"
           href="#/receiver/tips"
           popover="{{'Tips' | translate}}"
           popover-placement="top"
           popover-trigger="mouseenter"
           class="btn btn-default">
          <span class="glyphicon glyphicon-th-list"></span>
        </a>

        <span id="tip-action-postpone"
              data-ng-if="preferences.can_postpone_expiration"
              data-ng-click="tip_postpone()"
              popover="{{'Postpone tip expiration date' | translate}}"
              popover-placement="top"
              popover-trigger="mouseenter"
              class="btn btn-default">
          <i class="glyphicon glyphicon-time"></i>
        </span>

        <span id="tip-action-delete"
              data-ng-if="preferences.can_delete_submission"
              data-ng-click="tip_delete()"
              popover="{{'Delete tip' | translate}}"
              popover-placement="top"
              popover-trigger="mouseenter"
              class="btn btn-default">
          <span class="glyphicon glyphicon-trash"></span>
        </span>

        <span id="link-reload"
              data-ng-click="reload()"
              popover="{{'Refresh page' | translate}}"
              popover-placement="top"
              popover-trigger="mouseenter"
              class="btn btn-default">
          <span class="glyphicon glyphicon-refresh"></span>
        </span> 
      </div>

      <div class="pull-right">
        <a id="link-preferences"
           href="#/receiver/preferences"
           popover="{{'Preferences' | translate}}"
           popover-placement="top"
           popover-trigger="mouseenter"
           class="btn btn-default">
          <span class="glyphicon glyphicon-cog"></span>
        </a>
      </div>
    </div>
  </div>
  <br />
  <div class="row" data-ng-show="preferences.pgp_key_status != 'enabled'">
    <div class="col-md-12">
      <div class="alert alert-warning">
        <i class="glyphicon glyphicon-warning-sign"></i>
        <strong><span data-translate>Warning!</span></strong>
        <span data-translate>You have not configured your encryption keys, so the files will be stored on the GlobaLeaks server un-encrypted.</span>
        <span data-translate>This may lead to unintended access to the files by the server administrator or others in case the server is compromised.</span>
        <span data-translate>Please configure your PGP keys in the receiver preferences page.</span>
      </div>
    </div>
  </div>
  <div class="row" data-ng-show="tip_unencrypted">
    <div class="col-md-12">
      <div class="alert alert-warning">
        <i class="glyphicon glyphicon-warning-sign"></i>
        <strong><span data-translate>Warning!</span></strong>
        <span data-translate>One or more of the receivers of this tip has not configured a PGP key.</span>
        <span data-translate>This means that the submitted files will be stored in plaintext on the server.</span>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div data-ng-include="'views/partials/tip_questionnaire_answers.html'"></div>
    </div>

    <div class="col-md-6">
      <div data-ng-if="tip.show_receivers" data-ng-include="'views/partials/tip_receivers_info.html'"></div>
    </div>
  </div>

  <hr />
  
  <div class="row">
    <div class="col-md-12">
      <div class="TipPageSectionTitle" data-translate>Files</div>
      <div class="well" data-ng-show="tip.files.length">
        <div data-ng-if="tip.collection">
          <form id="fileCollectionDownload" method="POST" action="{{::tip.collection}}" novalidate>
            <input type="hidden" name="x-session" value="{{session}}">
            <input type="hidden" name="xsrf-token" value="{{xsrf_token}}">
            <button class="btn btn-xs btn-default">
              <i class="glyphicon glyphicon-download"></i>
              <span data-translate>download all files</span>
            </button>
          </form>
        </div>
        <br />
        <a class="input-small" data-ng-click="show_new_files = !show_new_files" data-ng-init="show_new_files = false" data-ng-show="!show_new_files">
          <span data-translate>show only files not yet downloaded</span>
        </a>
        <a class="input-small" data-ng-click="show_new_files = !show_new_files" data-ng-show="show_new_files">
          <span data-translate>show all the files</span>
        </a>
        <br /><br />
        <div class="table-container">
          <table class="table table-striped" id="fileList">
            <thead>
              <tr>
                <th>
                  <span data-translate>Filename</span>
                </th>
                <th>
                  <span data-translate>Download</span>
                </th>
                <th>
                  <span data-translate>Upload Date</span>
                </th>
                <th>
                  <span data-translate>Content Type</span>
                </th>
                <th>
                  <span data-translate>File Size</span>
                </th>
              </tr>
            </thead>
            <tbody id="fileListBody" data-ng-repeat="file in tip.files">
              <tr id="file-{{$index}}" data-ng-show="!show_new_files || (show_new_files && file.downloads == 0)">
                <td>
                  <span>{{::file.name}}</span>
                </td>
                <td data-ng-show="file.status != 'unavailable'">
                  <form id="fileDownload" method="POST" action="{{::file.href}}" novalidate>
                    <input type="hidden" name="x-session" value="{{session}}">
                    <input type="hidden" name="xsrf-token" value="{{xsrf_token}}">
                    <button class="btn btn-xs btn-default">
                      <i class="glyphicon glyphicon-download"></i>
                      <span data-translate>download</span>
                    </button>
                  </form>
                </td>
                <td data-ng-show="file.status == 'unavailable'">
                  <div class="label label-warning" popover="{{'The file is unavailable due to an internal error.' | translate}}" popover-placement="bottom" popover-trigger="mouseenter" data-translate>file unavailable</div>
                </td>
                <td data-ng-show="file.status == 'nokey'">
                  <div class="label label-warning" popover="{{'The file is unavailable due to missing pgp key.' | translate}}" popover-placement="bottom" popover-trigger="mouseenter" data-translate>file unavailable</div>
                </td>
                <td>
                  <span>{{::file.creation_date | date:'dd-MM-yyyy'}}</span>
                </td>
                <td>
                  <span>{{::file.content_type}}</span>
                </td>
                <td>
                  <span>{{::file.size | prettyBytes}}</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-12" data-ng-hide="tip.files.length">
      <span data-translate>No files have been uploaded!</span>
    </div>

  </div>

  <hr />

  <div data-ng-include="'views/partials/tip_communication.html'"></div>
</div>
